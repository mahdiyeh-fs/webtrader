define(["exports","jquery","../websockets/binary_websockets","../navigation/menu","../common/marketUtils","jquery-growl"],function(e,n,t,a,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.init=void 0;var d=i(n),c=i(t),l=i(a);function i(e){return e&&e.__esModule?e:{default:e}}function m(e){d.default.growl.error({message:e.message})}function r(e,n){var r=isFinancialAccout(),s=!!e&&isGamingAccount(e),o=!!n&&"gb"===n;c.default.send({active_symbols:"brief"}).then(function(e){var n=e.active_symbols,t=void 0;t=r?[]:o||s?n.filter(function(e){return isSynthetic(e.market)}):n;var a=_(t).groupBy("market").map(function(e){var n=e,t=_.head(n),a={name:t.market,display_name:t.market_display_name};return a.submarkets=_(n).groupBy("submarket").map(function(e){var n=_.head(e),t={name:n.submarket,display_name:n.submarket_display_name};return t.instruments=_.map(e,function(e){return{symbol:e.symbol,display_name:e.display_name,is_disabled:e.is_trading_suspended||!e.exchange_is_open,pip:e.pip}}),t.is_disabled=_.every(t.instruments,"is_disabled"),t}).value(),a.is_disabled=_.every(a.submarkets,"is_disabled"),a}).value();a=(0,u.getSortedMarketSubmarkets)(a);var i=(0,d.default)("#nav-menu").find(".trade");l.default.refreshMenu(i,a,function(t,a,i){c.default.send({contracts_for:t}).then(function(n){require(["trade/tradeDialog"],function(e){return e.init({symbol:t,display_name:a,pip:i},n.contracts_for)})}).catch(m)})}).catch(m)}function s(){local_storage.get("oauth")?c.default.cached.authorize().then(function(){var t=local_storage.get("authorize").country;c.default.cached.send({landing_company:t}).then(function(e){var n=e.landing_company;r(n,t)})}):r()}var o=e.init=function(){require(["trade/tradeDialog"]),s(),require(["websockets/binary_websockets"],function(e){e.events.on("login",s),e.events.on("logout",s)})};e.default={init:o}});