{"version":3,"sources":["../../../../src/trade/tradeMenu.es6"],"names":["show_error","err","$","growl","error","message","console","refresh_active_symbols","liveapi","cached","send","active_symbols","then","data","markets","_","groupBy","map","activSymbols","sym","head","market","name","display_name","market_display_name","submarkets","symbols","submarket","submarket_display_name","instruments","symbol","is_disabled","is_trading_suspended","exchange_is_open","pip","every","value","trade","find","menu","refreshMenu","contracts_for","res","require","tradeDialog","init","catch","events","on"],"mappings":";;;;;;;;;;;;;;;;;;;;AAMA,OAAMA,aAAa,SAAbA,UAAa,CAACC,GAAD,EAAS;AACzBC,uBAAEC,KAAF,CAAQC,KAAR,CAAc,EAAEC,SAASJ,IAAII,OAAf,EAAd;AACAC,cAAQF,KAAR,CAAcH,GAAd;AACF,IAHD;AAIA,OAAMM,yBAAyB,SAAzBA,sBAAyB,GAAM;AAClCC,kCACIC,MADJ,CAEIC,IAFJ,CAES,EAAEC,gBAAgB,OAAlB,EAFT,EAGIC,IAHJ,CAGS,UAACC,IAAD,EAAU;AACb;AACA,aAAIC,UAAUC,EAAEF,KAAKF,cAAP,EAAuBK,OAAvB,CAA+B,QAA/B,EAAyCC,GAAzC,CAA6C,UAACC,YAAD,EAAkB;AAC1E,gBAAMC,MAAMJ,EAAEK,IAAF,CAAOF,YAAP,CAAZ;AACA,gBAAMG,SAAS,EAAEC,MAAMH,IAAIE,MAAZ,EAAoBE,cAAcJ,IAAIK,mBAAtC,EAAf;AACAH,mBAAOI,UAAP,GAAoBV,EAAEG,YAAF,EAAgBF,OAAhB,CAAwB,WAAxB,EAAqCC,GAArC,CAAyC,UAACS,OAAD,EAAa;AACvE,mBAAMP,MAAMJ,EAAEK,IAAF,CAAOM,OAAP,CAAZ;AACA,mBAAMC,YAAY,EAAEL,MAAMH,IAAIQ,SAAZ,EAAuBJ,cAAcJ,IAAIS,sBAAzC,EAAlB;AACAD,yBAAUE,WAAV,GAAwBd,EAAEE,GAAF,CAAMS,OAAN,EAAc,UAACP,GAAD;AAAA,yBAAU;AAC1CW,6BAAQX,IAAIW,MAD8B;AAE1CP,mCAAcJ,IAAII,YAFwB;AAG1CQ,kCAAaZ,IAAIa,oBAAJ,IAA4B,CAACb,IAAIc,gBAHJ;AAI1CC,0BAAKf,IAAIe;AAJiC,mBAAV;AAAA,gBAAd,CAAxB;AAOAP,yBAAUI,WAAV,GAAwBhB,EAAEoB,KAAF,CAAQR,UAAUE,WAAlB,EAA+B,aAA/B,CAAxB;AACA,sBAAOF,SAAP;AACF,aAZmB,EAYjBS,KAZiB,EAApB;AAaAf,mBAAOU,WAAP,GAAqBhB,EAAEoB,KAAF,CAAQd,OAAOI,UAAf,EAA2B,aAA3B,CAArB;AACA,mBAAOJ,MAAP;AACF,UAlBa,EAkBXe,KAlBW,EAAd;AAmBAtB,mBAAU,4CAA0BA,OAA1B,CAAV;;AAEA,aAAMuB,QAAQ,sBAAE,WAAF,EAAeC,IAAf,CAAoB,QAApB,CAAd;AACAC,wBAAKC,WAAL,CAAiBH,KAAjB,EAAwBvB,OAAxB,EAAiC,UAACgB,MAAD,EAASP,YAAT,EAAuBW,GAAvB,EAA+B;AAC7D1B,wCACIE,IADJ,CACS,EAAE+B,eAAeX,MAAjB,EADT,EAEIlB,IAFJ,CAES,UAAC8B,GAAD,EAAS;AACZC,uBAAQ,CAAC,mBAAD,CAAR,EACG,UAACC,WAAD;AAAA,yBAAiBA,YAAYC,IAAZ,CAAiB,EAACf,cAAD,EAASP,0BAAT,EAAuBW,QAAvB,EAAjB,EAA8CQ,IAAID,aAAlD,CAAjB;AAAA,gBADH;AAGF,aANJ,EAMMK,KANN,CAMY9C,UANZ;AAOF,UARD;AASF,OApCJ,EAqCI8C,KArCJ,CAqCU9C,UArCV;AAsCF,IAvCD;;AAyCO,OAAM6C,sBAAO,SAAPA,IAAO,GAAM;AACvBF,cAAQ,CAAC,mBAAD,CAAR,EADuB,CACS;AAChCpC;AACAoC,cAAQ,CAAC,8BAAD,CAAR,EAA0C,UAACnC,OAAD,EAAa;AACpDA,iBAAQuC,MAAR,CAAeC,EAAf,CAAkB,OAAlB,EAA2BzC,sBAA3B;AACAC,iBAAQuC,MAAR,CAAeC,EAAf,CAAkB,QAAlB,EAA4BzC,sBAA5B;AACF,OAHD;AAIF,IAPM;;qBASS,EAAEsC,UAAF,E","file":"tradeMenu.js","sourcesContent":["ï»¿import $ from 'jquery';\nimport liveapi from '../websockets/binary_websockets';\nimport menu from '../navigation/menu';\nimport { getSortedMarketSubmarkets } from '../common/marketUtils';\nimport \"jquery-growl\";\n\nconst show_error = (err) => {\n   $.growl.error({ message: err.message });\n   console.error(err);\n};\nconst refresh_active_symbols = () => {\n   liveapi\n      .cached\n      .send({ active_symbols: 'brief' })\n      .then((data) => {\n         /* clean up the data! */\n         let markets = _(data.active_symbols).groupBy('market').map((activSymbols) => {\n            const sym = _.head(activSymbols);\n            const market = { name: sym.market, display_name: sym.market_display_name };\n            market.submarkets = _(activSymbols).groupBy('submarket').map((symbols) => {  \n               const sym = _.head(symbols);\n               const submarket = { name: sym.submarket, display_name: sym.submarket_display_name };\n               submarket.instruments = _.map(symbols,(sym) => ({\n                     symbol: sym.symbol,\n                     display_name: sym.display_name,\n                     is_disabled: sym.is_trading_suspended || !sym.exchange_is_open,\n                     pip: sym.pip\n                  })\n               );\n               submarket.is_disabled = _.every(submarket.instruments, 'is_disabled');\n               return submarket;\n            }).value();\n            market.is_disabled = _.every(market.submarkets, 'is_disabled');\n            return market;\n         }).value();\n         markets = getSortedMarketSubmarkets(markets);\n\n         const trade = $(\"#nav-menu\").find(\".trade\");\n         menu.refreshMenu(trade, markets, (symbol, display_name, pip) => {\n            liveapi\n               .send({ contracts_for: symbol })\n               .then((res) => {\n                  require(['trade/tradeDialog'],\n                     (tradeDialog) => tradeDialog.init({symbol, display_name, pip}, res.contracts_for)\n                  );\n               }).catch(show_error);\n         });\n      })\n      .catch(show_error);\n}\n\nexport const init = () => {\n   require(['trade/tradeDialog']); // Trigger loading of tradeDialog\n   refresh_active_symbols();\n   require(['websockets/binary_websockets'], (liveapi) => {\n      liveapi.events.on('login', refresh_active_symbols);\n      liveapi.events.on('logout', refresh_active_symbols);\n   });\n}\n\nexport default  { init };\n"]}