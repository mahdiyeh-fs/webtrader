define(["exports","jquery","../websockets/binary_websockets","../navigation/menu","../common/marketUtils","jquery-growl"],function(e,a,t,n,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.init=void 0;var s=d(a),i=d(t),u=d(n);function d(e){return e&&e.__esModule?e:{default:e}}function o(e){s.default.growl.error({message:e.message})}function m(){return new Promise(function(e){i.default.cached.authorize().then(function(){i.default.cached.send({active_symbols:"brief"}).then(function(e){var a=_(e.active_symbols).groupBy("market").map(function(e){var a=filterRestrictedSymbols(e),t=_.head(a),n={name:t.market,display_name:t.market_display_name};return n.submarkets=_(a).groupBy("submarket").map(function(e){var a=_.head(e),t={name:a.submarket,display_name:a.submarket_display_name};return t.instruments=_.map(e,function(e){return{symbol:e.symbol,display_name:e.display_name,is_disabled:e.is_trading_suspended||!e.exchange_is_open,pip:e.pip}}),t.is_disabled=_.every(t.instruments,"is_disabled"),t}).value(),n.is_disabled=_.every(n.submarkets,"is_disabled"),n}).value();a=(0,r.getSortedMarketSubmarkets)(a);var t=(0,s.default)("#nav-menu").find(".trade");u.default.refreshMenu(t,a,function(t,n,r){i.default.send({contracts_for:t}).then(function(a){require(["trade/tradeDialog"],function(e){return e.init({symbol:t,display_name:n,pip:r},a.contracts_for)})}).catch(o)})}).catch(o)}).catch(function(){i.default.cached.send({active_symbols:"brief"}).then(function(e){var a=_(e.active_symbols).groupBy("market").map(function(e){var a=filterRestrictedSymbols(e),t=_.head(a),n={name:t.market,display_name:t.market_display_name};return n.submarkets=_(a).groupBy("submarket").map(function(e){var a=_.head(e),t={name:a.submarket,display_name:a.submarket_display_name};return t.instruments=_.map(e,function(e){return{symbol:e.symbol,display_name:e.display_name,is_disabled:e.is_trading_suspended||!e.exchange_is_open,pip:e.pip}}),t.is_disabled=_.every(t.instruments,"is_disabled"),t}).value(),n.is_disabled=_.every(n.submarkets,"is_disabled"),n}).value();a=(0,r.getSortedMarketSubmarkets)(a);var t=(0,s.default)("#nav-menu").find(".trade");u.default.refreshMenu(t,a,function(t,n,r){i.default.send({contracts_for:t}).then(function(a){require(["trade/tradeDialog"],function(e){return e.init({symbol:t,display_name:n,pip:r},a.contracts_for)})}).catch(o)})}).catch(o)})})}var l=e.init=function(){require(["trade/tradeDialog"]),m(),require(["websockets/binary_websockets"],function(e){e.events.on("login",m),e.events.on("logout",m)})};e.default={init:l}});