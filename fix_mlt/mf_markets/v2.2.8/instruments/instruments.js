define(["exports","jquery","websockets/binary_websockets","navigation/menu","charts/chartWindow","../common/marketUtils","jquery-growl","common/util"],function(t,e,a,n,r,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSpecificMarketData=t.isMarketDataPresent=t.getMarketData=t.init=void 0;var o=u(e),c=u(a),l=u(n),i=u(r);function u(t){return t&&t.__esModule?t:{default:t}}function s(t,e){var i=isFinancialAccout(),u=!!t&&isGamingAccount(t),s=!!e&&"gb"===e;c.default.send({active_symbols:"brief"}).then(function(t){var r=[],e=void 0;e=i?[]:s||u?t.active_symbols.filter(function(t){return isSynthetic(t.market)}):t.active_symbols,local_storage.set("active_symbols",e);var a=_(e).groupBy("market").map(function(t){var e=t,a=_.head(e),n={name:a.market,display_name:a.market_display_name};return n.submarkets=_(e).groupBy("submarket").map(function(t){var e=_.head(t),a={name:e.submarket,display_name:e.submarket_display_name};return a.instruments=_.map(t,function(t){return r.push(t.symbol),{symbol:t.symbol,display_name:t.display_name}}),a}).value(),n}).value();k=y.map(function(t){return{display_name:t.display_name,name:t.name,submarkets:t.submarkets.map(function(t){return{display_name:t.display_name,instruments:t.instruments.filter(function(t){return-1!==r.indexOf(t.symbol)})}}).filter(function(t){return 0!==t.instruments.length})}}).filter(function(t){return 0!==t.submarkets.length}),k=(0,m.getSortedMarketSubmarkets)(a);var n=(0,o.default)("#nav-menu").find(".instruments");n.find("> ul").remove(),l.default.refreshMenu(n,k,f)})}function d(){local_storage.get("oauth")?c.default.cached.authorize().then(function(){var a=local_storage.get("authorize").country;c.default.cached.send({landing_company:a}).then(function(t){var e=t.landing_company;s(e,a)})}):s()}function f(t,e){i.default.addNewWindow({instrumentCode:t,instrumentName:e,timePeriod:"1d",type:"candlestick"})}var k=[],y=[],p=t.init=function(){return c.default.cached.send({trading_times:(new Date).toISOString().slice(0,10)}).then(function(t){return y=l.default.extractChartableMarkets(t),d(),c.default.events.on("login",d),c.default.events.on("logout",d),y})},b=t.getMarketData=function(){return k},v=t.isMarketDataPresent=function(a,t){var n=!1;t=t||k;var r=this;return o.default.each(t,function(t,e){return e.submarkets||e.instruments?n=r.isMarketDataPresent(a,e.submarkets||e.instruments):o.default.trim(e.display_name)==o.default.trim(a)&&(n=!0),!n}),n},g=t.getSpecificMarketData=function(a,t){var n={};t=t||k;var r=this;return o.default.each(t,function(t,e){return e.submarkets||e.instruments?n=r.getSpecificMarketData(a,e.submarkets||e.instruments):o.default.trim(e.display_name)==o.default.trim(a)&&(n=e),o.default.isEmptyObject(n)}),n};t.default={init:p,getMarketData:b,isMarketDataPresent:v,getSpecificMarketData:g}});