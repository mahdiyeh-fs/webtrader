{"version":3,"sources":["../../../../src/trade/tradeMenu.es6"],"names":["show_error","err","$","growl","error","message","console","refresh_active_symbols","Promise","resolve","liveapi","cached","authorize","then","send","active_symbols","data","markets","_","groupBy","map","symbols","filtered_symbols","filterRestrictedSymbols","sym","head","market","name","display_name","market_display_name","submarkets","submarket","submarket_display_name","instruments","symbol","is_disabled","is_trading_suspended","exchange_is_open","pip","every","value","trade","find","menu","refreshMenu","contracts_for","res","require","tradeDialog","init","catch","events","on"],"mappings":"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","file":"tradeMenu.js","sourcesContent":["ï»¿import $ from 'jquery';\nimport liveapi from '../websockets/binary_websockets';\nimport menu from '../navigation/menu';\nimport { getSortedMarketSubmarkets } from '../common/marketUtils';\nimport \"jquery-growl\";\n\nconst show_error = (err) => {\n   $.growl.error({ message: err.message });\n   console.error(err);\n};\nconst refresh_active_symbols = () => {\n   return new Promise((resolve) => {\n      liveapi\n         .cached\n         .authorize()\n         .then(() => {\n            liveapi\n               .cached\n               .send({ active_symbols: 'brief' })\n               .then((data) => {\n                  /* clean up the data! */\n                  let markets = _(data.active_symbols).groupBy('market').map((symbols) => {\n                     const filtered_symbols = filterRestrictedSymbols(symbols);\n                     const sym = _.head(filtered_symbols);\n                     const market = { name: sym.market, display_name: sym.market_display_name };\n                     market.submarkets = _(filtered_symbols).groupBy('submarket').map((symbols) => {\n                        const sym = _.head(symbols);\n                        const submarket = { name: sym.submarket, display_name: sym.submarket_display_name };\n                        submarket.instruments = _.map(symbols, (sym) => ({\n                           symbol: sym.symbol,\n                           display_name: sym.display_name,\n                           is_disabled: sym.is_trading_suspended || !sym.exchange_is_open,\n                           pip: sym.pip\n                        })\n                        );\n                        submarket.is_disabled = _.every(submarket.instruments, 'is_disabled');\n                        return submarket;\n                     }).value();\n                     market.is_disabled = _.every(market.submarkets, 'is_disabled');\n                     return market;\n                  }).value();\n                  markets = getSortedMarketSubmarkets(markets);\n\n                  const trade = $(\"#nav-menu\").find(\".trade\");\n                  menu.refreshMenu(trade, markets, (symbol, display_name, pip) => {\n                     liveapi\n                        .send({ contracts_for: symbol })\n                        .then((res) => {\n                           require(['trade/tradeDialog'],\n                              (tradeDialog) => tradeDialog.init({ symbol, display_name, pip }, res.contracts_for)\n                           );\n                        }).catch(show_error);\n                  });\n               })\n               .catch(show_error);\n         })\n         .catch(\n            () => {\n               liveapi\n                  .cached\n                  .send({ active_symbols: 'brief' })\n                  .then((data) => {\n                     /* clean up the data! */\n                     let markets = _(data.active_symbols).groupBy('market').map((symbols) => {\n                        const filtered_symbols = filterRestrictedSymbols(symbols);\n                        const sym = _.head(filtered_symbols);\n                        const market = { name: sym.market, display_name: sym.market_display_name };\n                        market.submarkets = _(filtered_symbols).groupBy('submarket').map((symbols) => {\n                           const sym = _.head(symbols);\n                           const submarket = { name: sym.submarket, display_name: sym.submarket_display_name };\n                           submarket.instruments = _.map(symbols, (sym) => ({\n                              symbol: sym.symbol,\n                              display_name: sym.display_name,\n                              is_disabled: sym.is_trading_suspended || !sym.exchange_is_open,\n                              pip: sym.pip\n                           })\n                           );\n                           submarket.is_disabled = _.every(submarket.instruments, 'is_disabled');\n                           return submarket;\n                        }).value();\n                        market.is_disabled = _.every(market.submarkets, 'is_disabled');\n                        return market;\n                     }).value();\n                     markets = getSortedMarketSubmarkets(markets);\n\n                     const trade = $(\"#nav-menu\").find(\".trade\");\n                     menu.refreshMenu(trade, markets, (symbol, display_name, pip) => {\n                        liveapi\n                           .send({ contracts_for: symbol })\n                           .then((res) => {\n                              require(['trade/tradeDialog'],\n                                 (tradeDialog) => tradeDialog.init({ symbol, display_name, pip }, res.contracts_for)\n                              );\n                           }).catch(show_error);\n                     });\n                  })\n                  .catch(show_error);\n            }\n         );\n   });\n}\n\nexport const init = () => {\n   require(['trade/tradeDialog']); // Trigger loading of tradeDialog\n   refresh_active_symbols();\n   require(['websockets/binary_websockets'], (liveapi) => {\n      liveapi.events.on('login', refresh_active_symbols);\n      liveapi.events.on('logout', refresh_active_symbols);\n   });\n}\n\nexport default { init };\n"]}