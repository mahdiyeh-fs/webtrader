define(["exports","jquery","../websockets/binary_websockets","../navigation/menu","../common/marketUtils","jquery-growl"],function(e,t,a,n,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.init=void 0;var d=r(t),c=r(a),l=r(n);function r(e){return e&&e.__esModule?e:{default:e}}function m(e){d.default.growl.error({message:e.message})}function i(e,t){var i=isMaltaInvest(),s=!!e&&isMalta(e),o=!!t&&"gb"===t;c.default.cached.send({active_symbols:"brief"}).then(function(e){var t=e.active_symbols,a=void 0;a=i?[]:o||s?t.filter(function(e){return t=e.market,/^(synthetic)/i.test(t);var t}):t;var n=_(a).groupBy("market").map(function(e){var t=e,a=_.head(t),n={name:a.market,display_name:a.market_display_name};return n.submarkets=_(t).groupBy("submarket").map(function(e){var t=_.head(e),a={name:t.submarket,display_name:t.submarket_display_name};return a.instruments=_.map(e,function(e){return{symbol:e.symbol,display_name:e.display_name,is_disabled:e.is_trading_suspended||!e.exchange_is_open,pip:e.pip}}),a.is_disabled=_.every(a.instruments,"is_disabled"),a}).value(),n.is_disabled=_.every(n.submarkets,"is_disabled"),n}).value();n=(0,u.getSortedMarketSubmarkets)(n);var r=(0,d.default)("#nav-menu").find(".trade");l.default.refreshMenu(r,n,function(a,n,r){c.default.send({contracts_for:a}).then(function(t){require(["trade/tradeDialog"],function(e){return e.init({symbol:a,display_name:n,pip:r},t.contracts_for)})}).catch(m)})}).catch(m)}function s(){local_storage.get("oauth")?c.default.cached.authorize().then(function(){var a=local_storage.get("authorize").country;c.default.cached.send({landing_company:a}).then(function(e){var t=e.landing_company;i(t,a)})}):i()}var o=e.init=function(){require(["trade/tradeDialog"]),s(),require(["websockets/binary_websockets"],function(e){e.events.on("login",s),e.events.on("logout",s)})};e.default={init:o}});