define(["exports","jquery","websockets/binary_websockets","navigation/menu","charts/chartWindow","../common/marketUtils","jquery-growl","common/util"],function(t,e,a,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSpecificMarketData=t.isMarketDataPresent=t.getMarketData=t.init=void 0;var s=l(e),u=l(a),m=l(n),o=l(r);function l(t){return t&&t.__esModule?t:{default:t}}function c(){u.default.cached.send({active_symbols:"brief"}).then(function(t){local_storage.set("active_symbols",t.active_symbols);var r=[];_(filterRestrictedSymbols(t.active_symbols)).groupBy("market").map(function(t){var e=t,a=_.head(e),n={name:a.market,display_name:a.market_display_name};return n.submarkets=_(e).groupBy("submarket").map(function(t){var e=_.head(t),a={name:e.submarket,display_name:e.submarket_display_name};return a.instruments=_.map(t,function(t){return r.push(t.symbol),{symbol:t.symbol,display_name:t.display_name}}),a}).value(),n}).value();k=y.map(function(t){return{display_name:t.display_name,name:t.name,submarkets:t.submarkets.map(function(t){return{display_name:t.display_name,instruments:t.instruments.filter(function(t){return-1!==r.indexOf(t.symbol)})}}).filter(function(t){return 0!==t.instruments.length})}}).filter(function(t){return 0!==t.submarkets.length}),k=(0,i.getSortedMarketSubmarkets)(k);var e=(0,s.default)("#nav-menu").find(".instruments");e.find("> ul").remove(),m.default.refreshMenu(e,k,f)})}function d(){local_storage.get("oauth")?u.default.cached.authorize().then(function(){c()}):c()}function f(t,e){o.default.addNewWindow({instrumentCode:t,instrumentName:e,timePeriod:"1d",type:"candlestick"})}var k=[],y=[],b=t.init=function(){return u.default.cached.send({trading_times:(new Date).toISOString().slice(0,10)}).then(function(t){return y=m.default.extractChartableMarkets(t),d(),u.default.events.on("login",d),u.default.events.on("logout",d),y})},p=t.getMarketData=function(){return k},v=t.isMarketDataPresent=function(a,t){var n=!1;t=t||k;var r=this;return s.default.each(t,function(t,e){return e.submarkets||e.instruments?n=r.isMarketDataPresent(a,e.submarkets||e.instruments):s.default.trim(e.display_name)==s.default.trim(a)&&(n=!0),!n}),n},g=t.getSpecificMarketData=function(a,t){var n={};t=t||k;var r=this;return s.default.each(t,function(t,e){return e.submarkets||e.instruments?n=r.getSpecificMarketData(a,e.submarkets||e.instruments):s.default.trim(e.display_name)==s.default.trim(a)&&(n=e),s.default.isEmptyObject(n)}),n};t.default={init:b,getMarketData:p,isMarketDataPresent:v,getSpecificMarketData:g}});